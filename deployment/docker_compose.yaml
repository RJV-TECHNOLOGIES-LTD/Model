# ==============================================
# 🏆 Industry Standard AI Execution & Cosmology
# 📌 Unified Model of Gravity + AI & Quantum AI
# 📌 High-Performance Computing & Multi-GPU Scaling
# ==============================================

# ⚡ BASE IMAGE: NVIDIA CUDA 12.1 for GPU Execution
FROM nvidia/cuda:12.1.0-devel-ubuntu22.04 AS base

# ✅ Set Up Essential Environment Variables
ENV DEBIAN_FRONTEND=noninteractive \
    LANG=C.UTF-8 LC_ALL=C.UTF-8 \
    PYTHONFAULTHANDLER=1 \
    PYTHONUNBUFFERED=1 \
    PYTHONHASHSEED=random \
    NVIDIA_VISIBLE_DEVICES=all \
    NVIDIA_DRIVER_CAPABILITIES=compute,utility \
    NVIDIA_REQUIRE_CUDA="cuda>=12.1"

# ==============================================
# 🔹 SYSTEM-LEVEL DEPENDENCIES
# ==============================================
RUN apt-get update && apt-get install -y \
    build-essential cmake \
    curl git wget unzip \
    libssl-dev libffi-dev \
    libhdf5-dev libopenblas-dev liblapack-dev \
    libxrender1 libgl1-mesa-glx \
    ffmpeg \
    && rm -rf /var/lib/apt/lists/*

# ==============================================
# 🔹 INSTALL PYTHON & PACKAGE MANAGERS
# ==============================================
WORKDIR /app

# Install Python 3.10 and upgrade Pip
RUN apt-get update && \
    apt-get install -y python3.10 python3-pip && \
    ln -s /usr/bin/python3.10 /usr/bin/python && \
    pip install --upgrade pip setuptools wheel

# ==============================================
# 🔹 INSTALL CORE AI, HPC, & QUANTUM AI PACKAGES
# ==============================================
COPY requirements.txt /app/
RUN pip install --no-cache-dir -r requirements.txt

# ✅ Install AI Execution Libraries (GPU-Optimized)
RUN pip install --no-cache-dir \
    torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121 \
    tensorflow[and-cuda] \
    cupy-cuda12x \
    jax[cuda12] \
    tensorflow-probability \
    opt-einsum

# ✅ Install Quantum AI Packages
RUN pip install --no-cache-dir \
    pennylane qiskit quimb

# ==============================================
# 🔹 INSTALL LIGO & GRAVITATIONAL WAVE ANALYSIS TOOLS
# ==============================================
RUN pip install --no-cache-dir \
    gwpy \
    ligo.skymap \
    astropy \
    healpy \
    galpy

# ==============================================
# 🔹 SECURITY, CLOUD, & MONITORING SYSTEMS
# ==============================================
RUN pip install --no-cache-dir \
    boto3 google-cloud-storage azure-storage-blob \
    prometheus-client opencensus grafana-client \
    cryptography python-dotenv pyjwt

# ==============================================
# 🔹 SET UP HIGH-PERFORMANCE COMPUTING ENVIRONMENT
# ==============================================
ENV MODEL_DIR=/app/models \
    DATA_DIR=/app/data \
    LOG_DIR=/app/logs

RUN mkdir -p $MODEL_DIR $DATA_DIR $LOG_DIR

# ==============================================
# 🔹 ADD PROJECT FILES
# ==============================================
COPY . /app/

# ==============================================
# 🔹 EXECUTION ENTRYPOINT - WEB SERVER API
# ==============================================
CMD ["uvicorn", "src.core.main:app", "--host", "0.0.0.0", "--port", "8000"]
